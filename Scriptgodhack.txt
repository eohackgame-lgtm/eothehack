local VirtualInputManager = game:GetService("VirtualInputManager")
local CollectionService = game:GetService("CollectionService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- 檢查是否成功獲取本地玩家
if not Player then
    warn("無法找到玩家。請確保您在客戶端運行腳本。")
    return
end

local PlayerGui = Player:WaitForChild("PlayerGui")

-- 顯示通知（加載時自動顯示）
game.StarterGui:SetCore("SendNotification", {
    Title = "eoHub",
    Text = "成功運行，祝你早日被封",
    Duration = 999
})

-- 創建主屏幕GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SimpleGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 創建圖標按鈕
local IconButton = Instance.new("ImageButton")
IconButton.Name = "IconButton"
IconButton.Size = UDim2.new(0, 60, 0, 60)
IconButton.Position = UDim2.new(0, 20, 0, 20)
IconButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
IconButton.BackgroundTransparency = 0.5
IconButton.Image = "rbxassetid://138136991120099"
IconButton.ScaleType = Enum.ScaleType.Fit
IconButton.Parent = ScreenGui

-- 創建圓角效果
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0.2, 0)
UICorner.Parent = IconButton

-- 創建主面板
local MainPanel = Instance.new("Frame")
MainPanel.Name = "MainPanel"
MainPanel.Size = UDim2.new(0, 300, 0, 250) -- 增加高度以容納新按鈕
MainPanel.Position = UDim2.new(0, 90, 0, 20)
MainPanel.BackgroundColor3 = Color3.fromRGB(0,0,0)
MainPanel.BackgroundTransparency = 0.1
MainPanel.Visible = false
MainPanel.Parent = ScreenGui

local MainPanelCorner = Instance.new("UICorner")
MainPanelCorner.CornerRadius = UDim.new(0.05, 0)
MainPanelCorner.Parent = MainPanel

-- 創建信息頁面面板
local InfoPanel = Instance.new("Frame")
InfoPanel.Name = "InfoPanel"
InfoPanel.Size = UDim2.new(0, 300, 0, 200)
InfoPanel.Position = UDim2.new(0, 90, 0, 20)
InfoPanel.BackgroundColor3 = Color3.fromRGB(0,0,0)
InfoPanel.BackgroundTransparency = 0.1
InfoPanel.Visible = false
InfoPanel.Parent = ScreenGui

local InfoPanelCorner = Instance.new("UICorner")
InfoPanelCorner.CornerRadius = UDim.new(0.05, 0)
InfoPanelCorner.Parent = InfoPanel

-- 在主面板添加传送按钮
local teleportButton = Instance.new("TextButton")
teleportButton.Name = "TeleportButton"
teleportButton.Size = UDim2.new(0, 150, 0, 40)
teleportButton.Position = UDim2.new(0, 20, 0, 20)
teleportButton.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
teleportButton.Text = "沿X軸負方向移動 (速度300)"
teleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
teleportButton.TextScaled = true
teleportButton.Parent = MainPanel

-- 在主面板添加停止按钮
local stopButton = Instance.new("TextButton")
stopButton.Name = "StopButton"
stopButton.Size = UDim2.new(0, 150, 0, 40)
stopButton.Position = UDim2.new(0, 20, 0, 70)
stopButton.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
stopButton.Text = "停止移動"
stopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
stopButton.TextScaled = true
stopButton.Parent = MainPanel

-- 在主面板添加信息页面按钮（右侧长方形按钮）
local infoButton = Instance.new("TextButton")
infoButton.Name = "InfoButton"
infoButton.Size = UDim2.new(0, 150, 0, 40)
infoButton.Position = UDim2.new(0, 20, 0, 120)
infoButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
infoButton.Text = "顯示信息"
infoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
infoButton.TextScaled = true
infoButton.Parent = MainPanel

-- 在主面板添加逃離功能開關
local escapeToggle = Instance.new("TextButton")
escapeToggle.Name = "EscapeToggle"
escapeToggle.Size = UDim2.new(0, 150, 0, 40)
escapeToggle.Position = UDim2.new(0, 20, 0, 170)
escapeToggle.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
escapeToggle.Text = "自動逃離: 開啟"
escapeToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
escapeToggle.TextScaled = true
escapeToggle.Parent = MainPanel

-- 在信息页面添加返回按钮
local backButton = Instance.new("TextButton")
backButton.Name = "BackButton"
backButton.Size = UDim2.new(0, 150, 0, 40)
backButton.Position = UDim2.new(0, 20, 0, 120)
backButton.BackgroundColor3 = Color3.fromRGB(200, 120, 80)
backButton.Text = "返回主頁"
backButton.TextColor3 = Color3.fromRGB(255, 255, 255)
backButton.TextScaled = true
backButton.Parent = InfoPanel

-- 在信息页面添加信息文本
local infoText = Instance.new("TextLabel")
infoText.Name = "InfoText"
infoText.Size = UDim2.new(0, 260, 0, 100)
infoText.Position = UDim2.new(0, 20, 0, 20)
infoText.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
infoText.BackgroundTransparency = 0.3
infoText.Text = "eoHub 信息頁面\n\n版本: 1.0\n功能: 自動移動\n作者: eoHub團隊"
infoText.TextColor3 = Color3.fromRGB(255, 255, 255)
infoText.TextScaled = true
infoText.Font = Enum.Font.Gotham
infoText.Parent = InfoPanel

-- 創建緊急停止按鈕（平時隱藏）
local emergencyStopButton = Instance.new("TextButton")
emergencyStopButton.Name = "EmergencyStopButton"
emergencyStopButton.Size = UDim2.new(0, 200, 0, 80)
emergencyStopButton.Position = UDim2.new(0.5, -100, 0.5, -40)
emergencyStopButton.AnchorPoint = Vector2.new(0.5, 0.5)
emergencyStopButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
emergencyStopButton.Text = "緊急停止\n(血量低於10%自動觸發)"
emergencyStopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
emergencyStopButton.TextScaled = true
emergencyStopButton.Visible = false
emergencyStopButton.ZIndex = 10
emergencyStopButton.Parent = ScreenGui

-- 为所有按钮添加圆角
local teleportCorner = Instance.new("UICorner")
teleportCorner.CornerRadius = UDim.new(0, 8)
teleportCorner.Parent = teleportButton

local stopCorner = Instance.new("UICorner")
stopCorner.CornerRadius = UDim.new(0, 8)
stopCorner.Parent = stopButton

local infoCorner = Instance.new("UICorner")
infoCorner.CornerRadius = UDim.new(0, 8)
infoCorner.Parent = infoButton

local escapeToggleCorner = Instance.new("UICorner")
escapeToggleCorner.CornerRadius = UDim.new(0, 8)
escapeToggleCorner.Parent = escapeToggle

local backCorner = Instance.new("UICorner")
backCorner.CornerRadius = UDim.new(0, 8)
backCorner.Parent = backButton

local infoTextCorner = Instance.new("UICorner")
infoTextCorner.CornerRadius = UDim.new(0, 8)
infoTextCorner.Parent = infoText

local emergencyStopCorner = Instance.new("UICorner")
emergencyStopCorner.CornerRadius = UDim.new(0, 12)
emergencyStopCorner.Parent = emergencyStopButton

-- 控制变量
local isMoving = false
local moveConnection = nil
local isEscaping = false
local escapeConnection = nil
local isEscapeEnabled = true -- 加載時自動開啟
local healthCheckConnection = nil

-- 獲取玩家血量函數
local function getPlayerHealth()
    if not Player.Character then return 100 end
    
    local humanoid = Player.Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return 100 end
    
    return humanoid.Health
end

-- 逃離功能
local function startEscape()
    if isEscaping or not Player.Character then return end
    
    isEscaping = true
    
    -- 顯示緊急停止按鈕
    emergencyStopButton.Visible = true
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "自動逃離",
        Text = "血量低於10%，自動向上逃離！",
        Duration = 5
    })
    
    -- 執行逃離
    escapeConnection = RunService.Heartbeat:Connect(function(deltaTime)
        if not isEscaping or not Player.Character or not isEscapeEnabled then
            if escapeConnection then
                escapeConnection:Disconnect()
                escapeConnection = nil
            end
            return
        end
        
        local hrp = Player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local currentPos = hrp.Position
            -- 計算新的Y位置，速度為300每秒，向上移動
            local newY = currentPos.Y + (300 * deltaTime)
            
            -- 設置新位置 (保持X和Z不變，Y軸向上移動)
            hrp.CFrame = CFrame.new(currentPos.X, newY, currentPos.Z)
        end
    end)
end

-- 停止逃離功能
local function stopEscape()
    isEscaping = false
    emergencyStopButton.Visible = false
    
    if escapeConnection then
        escapeConnection:Disconnect()
        escapeConnection = nil
    end
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "逃離停止",
        Text = "自動逃離已停止",
        Duration = 3
    })
end

-- 血量檢查循環
healthCheckConnection = RunService.Heartbeat:Connect(function()
    if not isEscapeEnabled then return end
    
    local health = getPlayerHealth()
    
    -- 如果血量低於10%且不在逃離狀態，開始逃離
    if health < 10 and not isEscaping then
        startEscape()
    -- 如果血量回到50%以上且在逃離狀態，停止逃離
    elseif health >= 50 and isEscaping then
        stopEscape()
    end
end)

-- 移動功能
teleportButton.MouseButton1Click:Connect(function()
    if not Player.Character then return end
    
    local humanoidRootPart = Player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    isMoving = true
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "移動中",
        Text = "正在沿X軸負方向移動，速度300...",
        Duration = 3
    })
    
    -- 獲取當前位置
    local currentPos = humanoidRootPart.Position
    local currentCFrame = humanoidRootPart.CFrame
    
    -- 向左旋轉90度（使船頭朝向移動方向的右側）
    local rotatedCFrame = currentCFrame * CFrame.Angles(0, math.rad(90), 0)
    
    -- 執行初始位置設定 (高度200，並旋轉90度)
    humanoidRootPart.CFrame = CFrame.new(currentPos.X, 200, currentPos.Z) * CFrame.Angles(0, math.rad(90), 0)
    
    -- 持續移動
    moveConnection = RunService.Heartbeat:Connect(function(deltaTime)
        if not isMoving or not Player.Character then
            moveConnection:Disconnect()
            return
        end
        
        local hrp = Player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local currentPos = hrp.Position
            -- 計算新的X位置，速度為300每秒，向負方向移動
            local newX = currentPos.X - (300 * deltaTime)
            
            -- 設置新位置 (保持Z不變，高度200，X軸負方向移動，保持旋轉)
            hrp.CFrame = CFrame.new(newX, 200, currentPos.Z) * CFrame.Angles(0, math.rad(90), 0)
        end
    end)
end)

-- 停止功能
stopButton.MouseButton1Click:Connect(function()
    isMoving = false
    
    if moveConnection then
        moveConnection:Disconnect()
        moveConnection = nil
    end
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "已停止",
        Text = "移動已停止",
        Duration = 3
    })
end)

-- 信息按钮功能
infoButton.MouseButton1Click:Connect(function()
    MainPanel.Visible = false
    InfoPanel.Visible = true
end)

-- 返回按钮功能
backButton.MouseButton1Click:Connect(function()
    InfoPanel.Visible = false
    MainPanel.Visible = true
end)

-- 逃離開關功能
escapeToggle.MouseButton1Click:Connect(function()
    isEscapeEnabled = not isEscapeEnabled
    
    if isEscapeEnabled then
        escapeToggle.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
        escapeToggle.Text = "自動逃離: 開啟"
        game.StarterGui:SetCore("SendNotification", {
            Title = "自動逃離",
            Text = "自動逃離功能已開啟",
            Duration = 3
        })
    else
        escapeToggle.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
        escapeToggle.Text = "自動逃離: 關閉"
        stopEscape() -- 關閉時也停止當前逃離
        game.StarterGui:SetCore("SendNotification", {
            Title = "自動逃離",
            Text = "自動逃離功能已關閉",
            Duration = 3
        })
    end
end)

-- 緊急停止按鈕功能
emergencyStopButton.MouseButton1Click:Connect(function()
    isEscapeEnabled = false
    escapeToggle.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
    escapeToggle.Text = "自動逃離: 關閉"
    stopEscape()
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "緊急停止",
        Text = "自動逃離功能已手動關閉",
        Duration = 5
    })
end)

-- 圖標點擊事件（只顯示主面板，不發送通知）
IconButton.MouseButton1Click:Connect(function()
    MainPanel.Visible = not MainPanel.Visible
    InfoPanel.Visible = false -- 確保信息面板隱藏
end)