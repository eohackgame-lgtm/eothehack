-- 創建GUI
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 創建主屏幕GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FastAttackGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 創建圖標按鈕
local IconButton = Instance.new("ImageButton")
IconButton.Name = "IconButton"
IconButton.Size = UDim2.new(0, 60, 0, 60)
IconButton.Position = UDim2.new(0, 20, 0.5, -30)
IconButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
IconButton.BackgroundTransparency = 0.5
IconButton.Image = "rbxassetid://138136991120099"
IconButton.ScaleType = Enum.ScaleType.Fit
IconButton.Parent = ScreenGui

-- 創建圓角效果
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0.2, 0)
UICorner.Parent = IconButton

-- 創建面板
local Panel = Instance.new("Frame")
Panel.Name = "Panel"
Panel.Size = UDim2.new(0, 300, 0, 200)
Panel.Position = UDim2.new(0, 90, 0.5, -100)
Panel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Panel.BackgroundTransparency = 0.2
Panel.Visible = false
Panel.Parent = ScreenGui

local PanelCorner = Instance.new("UICorner")
PanelCorner.CornerRadius = UDim.new(0.05, 0)
PanelCorner.Parent = Panel

-- 面板標題
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.BackgroundTransparency = 0.1
Title.Text = "快速攻擊設置"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.Parent = Panel

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0.05, 0.05)
TitleCorner.Parent = Title

-- 開關容器
local ToggleContainer = Instance.new("Frame")
ToggleContainer.Name = "ToggleContainer"
ToggleContainer.Size = UDim2.new(1, -40, 0, 50)
ToggleContainer.Position = UDim2.new(0, 20, 0, 60)
ToggleContainer.BackgroundTransparency = 1
ToggleContainer.Parent = Panel

-- 開關標籤
local ToggleLabel = Instance.new("TextLabel")
ToggleLabel.Name = "ToggleLabel"
ToggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
ToggleLabel.Position = UDim2.new(0, 0, 0, 0)
ToggleLabel.BackgroundTransparency = 1
ToggleLabel.Text = "超快攻擊"
ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleLabel.TextSize = 16
ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
ToggleLabel.Font = Enum.Font.Gotham
ToggleLabel.Parent = ToggleContainer

-- 開關按鈕
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 50, 0, 30)
ToggleButton.Position = UDim2.new(1, -50, 0.5, -15)
ToggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
ToggleButton.Text = ""
ToggleButton.Parent = ToggleContainer

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0.5, 0)
ToggleCorner.Parent = ToggleButton

-- 開關指示器
local ToggleIndicator = Instance.new("Frame")
ToggleIndicator.Name = "ToggleIndicator"
ToggleIndicator.Size = UDim2.new(0, 20, 0, 20)
ToggleIndicator.Position = UDim2.new(0, 5, 0.5, -10)
ToggleIndicator.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ToggleIndicator.Parent = ToggleButton

local IndicatorCorner = Instance.new("UICorner")
IndicatorCorner.CornerRadius = UDim.new(0.5, 0)
IndicatorCorner.Parent = ToggleIndicator

-- 範圍顯示
local RangeLabel = Instance.new("TextLabel")
RangeLabel.Name = "RangeLabel"
RangeLabel.Size = UDim2.new(1, -40, 0, 30)
RangeLabel.Position = UDim2.new(0, 20, 0, 120)
RangeLabel.BackgroundTransparency = 1
RangeLabel.Text = "攻擊範圍: 150"
RangeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
RangeLabel.TextSize = 14
RangeLabel.Font = Enum.Font.Gotham
RangeLabel.Parent = Panel

-- 狀態顯示
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -40, 0, 30)
StatusLabel.Position = UDim2.new(0, 20, 0, 150)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "狀態: 關閉"
StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
StatusLabel.TextSize = 14
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Parent = Panel

-- 開關狀態變量
local FastAttackEnabled = false
local FastAttackConnection = nil

-- 切換開關函數
local function ToggleFastAttack()
    FastAttackEnabled = not FastAttackEnabled
    
    if FastAttackEnabled then
        -- 開啟狀態
        TweenService:Create(ToggleIndicator, TweenInfo.new(0.2), {
            Position = UDim2.new(1, -25, 0.5, -10),
            BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        }):Play()
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(0, 100, 0)
        }):Play()
        StatusLabel.Text = "狀態: 開啟"
        StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        
        -- 啟動快速攻擊
        StartFastAttack()
    else
        -- 關閉狀態
        TweenService:Create(ToggleIndicator, TweenInfo.new(0.2), {
            Position = UDim2.new(0, 5, 0.5, -10),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        }):Play()
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        }):Play()
        StatusLabel.Text = "狀態: 關閉"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        -- 停止快速攻擊
        if FastAttackConnection then
            FastAttackConnection:Disconnect()
            FastAttackConnection = nil
        end
    end
end

-- 點擊開關按鈕
ToggleButton.MouseButton1Click:Connect(ToggleFastAttack)

-- 圖標點擊切換面板顯示
IconButton.MouseButton1Click:Connect(function()
    Panel.Visible = not Panel.Visible
end)

-- 快速攻擊系統
local function StartFastAttack()
    if FastAttackConnection then
        FastAttackConnection:Disconnect()
        FastAttackConnection = nil
    end
    
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    
    -- 安全獲取子對象函數
    local function SafeWaitForChild(parent, childName)
        local success, result = pcall(function()
            return parent:WaitForChild(childName)
        end)
        return success and result or nil
    end
    
    -- 基於你原來的腳本修復快速攻擊系統
    FastAttackConnection = RunService.Heartbeat:Connect(function()
        if not FastAttackEnabled or not Player.Character then 
            return 
        end
        
        -- 檢查角色是否存活
        local function IsAlive(character)
            return character and character:FindFirstChild("Humanoid") and character.Humanoid.Health > 0
        end
        
        if not IsAlive(Player.Character) then return end
        
        local AttackRange = 150 -- 攻擊範圍
        
        -- 獲取敵人
        local Enemies = workspace:FindFirstChild("Enemies")
        local Characters = workspace:FindFirstChild("Characters")
        
        if not Enemies then return end
        
        local OthersEnemies = {}
        local NearestHead = nil
        local NearestDistance = AttackRange
        
        -- 在敵人中尋找目標
        for _, Enemy in pairs(Enemies:GetChildren()) do
            if IsAlive(Enemy) then
                local Head = Enemy:FindFirstChild("Head")
                if Head then
                    local Distance = (Player.Character:GetPivot().Position - Head.Position).Magnitude
                    if Distance < NearestDistance then
                        table.insert(OthersEnemies, {Enemy, Head})
                        NearestHead = Head
                        NearestDistance = Distance
                    end
                end
            end
        end
        
        -- 在玩家角色中尋找目標（PvP）
        if Characters then
            for _, Character in pairs(Characters:GetChildren()) do
                if Character ~= Player.Character and IsAlive(Character) then
                    local Head = Character:FindFirstChild("Head")
                    if Head then
                        local Distance = (Player.Character:GetPivot().Position - Head.Position).Magnitude
                        if Distance < NearestDistance then
                            table.insert(OthersEnemies, {Character, Head})
                            NearestHead = Head
                            NearestDistance = Distance
                        end
                    end
                end
            end
        end
        
        -- 如果找到目標且裝備了武器，則攻擊
        if #OthersEnemies > 0 and NearestHead then
            local EquippedTool = Player.Character:FindFirstChildOfClass("Tool")
            if EquippedTool then
                -- 使用原腳本的遠程事件調用方式
                local Remotes = SafeWaitForChild(ReplicatedStorage, "Remotes")
                if Remotes then
                    local CommF = SafeWaitForChild(Remotes, "CommF_")
                    if CommF then
                        -- 發起攻擊
                        pcall(function()
                            -- 嘗試多種可能的攻擊方式
                            CommF:InvokeServer("Attack", NearestHead.Parent.Name)
                            CommF:InvokeServer("Click")
                        end)
                    end
                    
                    -- 嘗試使用Modules中的Net
                    local Modules = SafeWaitForChild(ReplicatedStorage, "Modules")
                    if Modules then
                        local Net = SafeWaitForChild(Modules, "Net")
                        if Net then
                            local RegisterAttack = SafeWaitForChild(Net, "RE/RegisterAttack")
                            local RegisterHit = SafeWaitForChild(Net, "RE/RegisterHit")
                            
                            if RegisterAttack and RegisterHit then
                                pcall(function()
                                    RegisterAttack:FireServer(0) -- 無延遲
                                    RegisterHit:FireServer(NearestHead, OthersEnemies)
                                end)
                            end
                        end
                    end
                end
            end
        end
    end)
end

-- 初始通知
task.spawn(function()
    wait(2)
    game.StarterGui:SetCore("SendNotification", {
        Title = "快速攻擊系統",
        Text = "GUI加載完成！點擊圖標打開設置",
        Duration = 5
    })
end)

-- 添加拖拽功能
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Panel.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Panel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Panel.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Panel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)
local lastNotificationTime = 0
local notificationCooldown = 10
local currentTime = tick()
if currentTime - lastNotificationTime >= notificationCooldown then
    game.StarterGui:SetCore("SendNotification", {
        Title = "eoHub",
        Text = "成功運行，祝你早日被封",
        Duration = 999
    })
    lastNotificationTime = currentTime
end